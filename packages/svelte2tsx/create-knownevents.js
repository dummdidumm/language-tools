const ts = require('typescript');
const fs = require('fs');

const filename = './svelte-jsx.d.ts';
const program = ts.createProgram([filename], {});
const sourcefile = program.getSourceFile(filename);

const definitions = sourcefile.statements[0].body.body.statements;

function getInterface(name) {
    return definitions.find((def) => ts.isInterfaceDeclaration(def) && def.name.text === name);
}

const domAttributes = getInterface('DOMAttributes');
const windowAttributes = getInterface('SvelteWindowProps');

const events = [...domAttributes.members, ...windowAttributes.members]
    .map((member) => member.name?.text)
    .filter((text) => text?.startsWith('on'));
const eventsStr = events.map((evt) => `'${evt}'`).join(',');

const text = `// Autogenerated, do not change
// prettier-ignore
export const knownEvents = new Set([${eventsStr}]);
`;

fs.writeFileSync('./src/knownevents.ts', text);
